<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Pigpen Cipher</title>
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #fafafa;
                min-height: 100vh;
                padding: 40px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            header {
                margin-bottom: 32px;
            }

            h1 {
                font-size: 28px;
                color: #333;
                margin-bottom: 8px;
                font-weight: 600;
            }

            .subtitle {
                color: #666;
                font-size: 14px;
            }

            .input-section {
                margin-bottom: 32px;
            }

            .input-wrapper {
                position: relative;
                margin-bottom: 12px;
            }

            input[type='text'] {
                width: 100%;
                padding: 12px;
                font-size: 16px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

            input[type='text']:focus {
                outline: none;
                border-color: #333;
            }

            .controls {
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
                align-items: center;
            }

            .toggle-label {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 14px;
                color: #666;
                cursor: pointer;
                user-select: none;
            }

            .toggle-label input[type='checkbox'] {
                cursor: pointer;
            }

            button {
                padding: 8px 16px;
                font-size: 14px;
                border: 1px solid #ccc;
                border-radius: 4px;
                cursor: pointer;
                background: white;
                color: #333;
            }

            button:hover {
                background: #f5f5f5;
                border-color: #999;
            }

            .btn-primary {
                background: #333;
                color: white;
                border-color: #333;
            }

            .btn-primary:hover {
                background: #555;
                border-color: #555;
            }

            .output-section {
                background: white;
                border: 1px solid #ddd;
                border-radius: 4px;
                padding: 24px;
                min-height: 200px;
            }

            .output-title {
                font-size: 13px;
                font-weight: 600;
                color: #666;
                margin-bottom: 16px;
            }

            .cipher-output {
                display: flex;
                flex-wrap: wrap;
                gap: 24px;
                align-items: center;
            }

            .word-group {
                display: flex;
                gap: 4px;
                align-items: center;
            }

            .symbol-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
            }

            .symbol-label {
                font-size: 11px;
                color: #999;
                font-weight: 500;
            }

            .keyboard-hint {
                margin-top: 16px;
                padding: 12px;
                background: white;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 12px;
                color: #666;
            }

            .keyboard-hint kbd {
                background: #f5f5f5;
                padding: 2px 6px;
                border: 1px solid #ccc;
                border-radius: 3px;
                font-family: monospace;
                font-weight: bold;
            }

            /* Modal Styles */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .modal.active {
                display: flex;
            }

            .modal-content {
                background: white;
                padding: 40px;
                border: 1px solid #ccc;
                border-radius: 4px;
                max-width: 900px;
                max-height: 90vh;
                overflow: auto;
            }

            .modal h2 {
                font-size: 24px;
                color: #333;
                margin-bottom: 24px;
                text-align: center;
                font-weight: 600;
            }

            .modal h3 {
                font-size: 16px;
                color: #666;
                margin: 24px 0 16px 0;
                text-align: center;
                font-weight: 600;
            }

            .reference-grid {
                display: flex;
                flex-direction: column;
                gap: 16px;
                margin-bottom: 24px;
            }

            .grid-section {
                display: flex;
                flex-direction: column;
                gap: 12px;
                padding: 20px;
                background: #fafafa;
                border: 1px solid #e0e0e0;
                border-radius: 4px;
            }

            .grid-row {
                display: flex;
                gap: 12px;
                justify-content: center;
            }

            .diamond-container {
                display: flex;
                gap: 48px;
                justify-content: center;
            }

            .diamond {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
            }

            .letter-comparison {
                display: flex;
                flex-wrap: wrap;
                gap: 16px;
                justify-content: center;
                padding: 20px;
                background: #fafafa;
                border: 1px solid #e0e0e0;
                border-radius: 4px;
            }

            .letter-box {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }

            .letter-box-label {
                font-size: 16px;
                font-weight: 600;
                color: #333;
            }

            .modal-close {
                display: block;
                margin: 24px auto 0;
                padding: 12px 32px;
                font-size: 16px;
            }

            hr {
                border: none;
                border-top: 1px solid #e0e0e0;
                margin: 16px 0;
            }

            /* Practice Mode Modal */
            .practice-output {
                background: white;
                border: 1px solid #ddd;
                border-radius: 4px;
                padding: 24px;
                min-height: 150px;
                margin-bottom: 24px;
            }

            .practice-input {
                width: 100%;
                padding: 12px;
                font-size: 16px;
                border: 1px solid #ccc;
                border-radius: 4px;
                margin-bottom: 16px;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .practice-controls {
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
                margin-top: 16px;
            }

            .answer-section {
                margin-top: 24px;
                padding: 16px;
                background: #f0f0f0;
                border-radius: 4px;
                display: none;
            }

            .answer-section.visible {
                display: block;
            }

            .answer-section h4 {
                margin: 0 0 8px 0;
                font-size: 14px;
                color: #666;
            }

            .answer-text {
                font-size: 16px;
                color: #333;
                line-height: 1.6;
            }

            .loading {
                text-align: center;
                color: #999;
                font-style: italic;
                padding: 40px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
                <h1>Pigpen Cipher</h1>
                <p class="subtitle">Encode your messages using the Pigpen cipher</p>
            </header>

            <div class="input-section">
                <div class="input-wrapper">
                    <input type="text" id="cipher-input" placeholder="Type your message here..." value="Secret message" />
                </div>
                <div class="controls">
                    <button class="btn-primary" id="show-reference">Show Reference Guide</button>
                    <button class="btn-primary" id="practice-mode">Practice Mode</button>
                    <button id="clear-btn">Clear</button>
                    <label class="toggle-label">
                        <input type="checkbox" id="show-labels" checked />
                        <span>Show letter labels</span>
                    </label>
                </div>
            </div>

            <div class="output-section">
                <div class="output-title">Encoded Message</div>
                <div class="cipher-output" id="output"></div>
            </div>

            <div class="keyboard-hint">Press <kbd>H</kbd> to show/hide reference guide • Press <kbd>ESC</kbd> to close</div>
        </div>

        <!-- Reference Modal -->
        <div class="modal" id="reference-modal">
            <div class="modal-content">
                <h2>Pigpen Cipher Reference</h2>

                <div class="grid-section">
                    <h3>Grid System (A-I)</h3>
                    <div id="grid-1"></div>
                </div>

                <div class="grid-section">
                    <h3>Grid with Dots (J-R)</h3>
                    <div id="grid-2"></div>
                </div>

                <div class="grid-section">
                    <h3>Diamond System (S-Z)</h3>
                    <div id="grid-3"></div>
                </div>

                <hr />

                <h3>Complete Alphabet</h3>
                <div class="letter-comparison" id="alphabet-reference"></div>

                <button class="btn-primary modal-close" id="close-modal">Close Reference</button>
            </div>
        </div>

        <!-- Practice Mode Modal -->
        <div class="modal" id="practice-modal">
            <div class="modal-content">
                <h2>Practice Mode</h2>
                <p style="color: #666; text-align: center; margin-bottom: 24px">Decode the cipher below and type your answer</p>

                <div class="practice-output" id="practice-output">
                    <div class="loading">Loading practice sentence...</div>
                </div>

                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333">Your Translation:</label>
                <input type="text" class="practice-input" id="practice-input" placeholder="Type what you think the cipher says..." />

                <div class="practice-controls">
                    <button class="btn-primary" id="check-answer">Check Answer</button>
                    <button id="reveal-answer">Reveal Answer</button>
                    <button id="new-practice">New Sentence</button>
                    <button id="close-practice">Close</button>
                </div>

                <div class="answer-section" id="answer-section">
                    <h4>Correct Answer:</h4>
                    <div class="answer-text" id="answer-text"></div>
                </div>
            </div>
        </div>

        <script>
            // SVG path data for Pigpen Cipher symbols
            const bl = 'M2 22h20',
                tl = 'M2 2h20',
                ll = 'M2 2v20',
                rl = 'M22 2v20';
            const dot = 'M12 12a1 1 0 1 0 0.00001 0';
            const bv = 'M2 22L12 2L22 22',
                bvd = 'M12 16a1 1 0 1 0 0.00001 0';
            const tv = 'M2 2L12 22L22 2',
                tvd = 'M12 8a1 1 0 1 0 0.00001 0';
            const rv = 'M22 2L2 12L22 22',
                rvd = 'M16 12a1 1 0 1 0 0.00001 0';
            const lv = 'M2 2L22 12L2 22',
                lvd = 'M8 12a1 1 0 1 0 0.00001 0';

            const letters = new Map([
                ['a', [bl, rl]],
                ['b', [bl, rl, ll]],
                ['c', [bl, ll]],
                ['d', [bl, rl, tl]],
                ['e', [bl, tl, rl, ll]],
                ['f', [bl, tl, ll]],
                ['g', [tl, rl]],
                ['h', [tl, rl, ll]],
                ['i', [tl, ll]],
                ['j', [bl, rl, dot]],
                ['k', [bl, rl, ll, dot]],
                ['l', [bl, ll, dot]],
                ['m', [bl, rl, tl, dot]],
                ['n', [bl, tl, rl, ll, dot]],
                ['o', [bl, tl, ll, dot]],
                ['p', [tl, rl, dot]],
                ['q', [tl, rl, ll, dot]],
                ['r', [tl, ll, dot]],
                ['s', [tv]],
                ['t', [lv]],
                ['u', [rv]],
                ['v', [bv]],
                ['w', [tv, tvd]],
                ['x', [lv, lvd]],
                ['y', [rv, rvd]],
                ['z', [bv, bvd]],
            ]);

            const APIS = [
                // {
                //     name: 'Quote Garden',
                //     url: 'https://quote-garden.onrender.com/api/v3/quotes/random',
                //     parse: data => {
                //         if (data && data.data && data.data[0] && data.data[0].quoteText) {
                //             return { text: data.data[0].quoteText, author: data.data[0].quoteAuthor };
                //         }
                //         return null;
                //     }
                // },
                // {
                //     name: 'Programming Quotes',
                //     url: 'https://programming-quotes-api.herokuapp.com/quotes/random',
                //     parse: data => {
                //         if (data && data.en) {
                //             return { text: data.en, author: data.author };
                //         }
                //         return null;
                //     }
                // }
                {
                    name: 'Zen Quotes',
                    url: 'https://zenquotes.io/api/random?2',
                    parse: (data) => {
                        if (data && data[0] && data[0].q) {
                            return {text: data[0].q, author: data[0].a};
                        }
                        return null;
                    },
                },
            ];

            // Fetch random quote from API
            async function fetchRandomQuote() {
                const randomAPI = APIS[Math.floor(Math.random() * APIS.length)];
                console.log(`Fetching quote from ${randomAPI.name}...`);
                try {
                    const response = await fetch(randomAPI.url);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    const quoteObj = randomAPI.parse(data);
                    if (quoteObj) return quoteObj;
                } catch (error) {
                    console.error(`Error fetching from ${randomAPI.name}:`, error);
                }

                // Fallback book/literature quotes
                const fallbacks = [
                    {text: 'Not all those who wander are lost.', author: 'J.R.R. Tolkien'},
                    {text: 'It does not do to dwell on dreams and forget to live.', author: 'J.K. Rowling'},
                    {text: 'So it goes.', author: 'Kurt Vonnegut'},
                    {text: 'All we have to decide is what to do with the time that is given us.', author: 'J.R.R. Tolkien'},
                    {text: 'It is our choices that show what we truly are, far more than our abilities.', author: 'J.K. Rowling'},
                    {text: 'The only way to do great work is to love what you do.', author: 'Steve Jobs'},
                    {text: 'In the middle of difficulty lies opportunity.', author: 'Albert Einstein'},
                    {text: 'The journey of a thousand miles begins with one step.', author: 'Lao Tzu'},
                    {text: "Life is what happens when you're busy making other plans.", author: 'John Lennon'},
                    {text: 'All animals are equal, but some animals are more equal than others.', author: 'George Orwell'},
                    {text: 'It was the best of times, it was the worst of times.', author: 'Charles Dickens'},
                    {text: 'To the well-organized mind, death is but the next great adventure.', author: 'J.K. Rowling'},
                    {text: 'There is no greater agony than bearing an untold story inside you.', author: 'Maya Angelou'},
                    {text: 'Whatever our souls are made of, his and mine are the same.', author: 'Emily Brontë'},
                    {text: 'It matters not what someone is born, but what they grow to be.', author: 'J.K. Rowling'},
                    {text: 'All we have to decide is what to do with the time that is given us.', author: 'J.R.R. Tolkien'},
                    {text: 'Not everything that is faced can be changed, but nothing can be changed until it is faced.', author: 'James Baldwin'},
                    {text: 'The only limit to our realization of tomorrow will be our doubts of today.', author: 'Franklin D. Roosevelt'},
                    {text: 'It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife.', author: 'Jane Austen'},
                    {text: "All the world's a stage, and all the men and women merely players.", author: 'William Shakespeare'},
                    {text: 'The answer to the ultimate question of life, the universe and everything is 42.', author: 'Douglas Adams'},
                    {text: 'You forget what you want to remember, and you remember what you want to forget.', author: 'Cormac McCarthy'},
                    {text: "It's the possibility of having a dream come true that makes life interesting.", author: 'Paulo Coelho'},
                    {text: "There is some good in this world, and it's worth fighting for.", author: 'J.R.R. Tolkien'},
                    {text: 'We accept the love we think we deserve.', author: 'Stephen Chbosky'},
                    {text: 'Stay gold, Ponyboy.', author: 'S.E. Hinton'},
                    {text: "Real courage is when you know you're licked before you begin, but you begin anyway and see it through no matter what.", author: 'Harper Lee'},
                    {text: 'Time you enjoy wasting is not wasted time.', author: 'Marthe Troly-Curtin'},
                    {text: "It's no use going back to yesterday, because I was a different person then.", author: 'Lewis Carroll'},
                    {text: 'The monsters are real, and ghosts are real too. They live inside us, and sometimes, they win.', author: 'Stephen King'},
                    {text: 'You never really understand a person until you consider things from his point of view.', author: 'Harper Lee'},
                    {text: 'The only thing necessary for the triumph of evil is for good men to do nothing.', author: 'Edmund Burke'},
                    {text: 'Even the darkest night will end and the sun will rise.', author: 'Victor Hugo'},
                    {text: 'It is our choices, Harry, that show what we truly are, far more than our abilities.', author: 'J.K. Rowling'},
                    {text: "All endings are also beginnings. We just don't know it at the time.", author: 'Mitch Albom'},
                    {text: 'The mind is its own place, and in itself can make a heaven of hell, a hell of heaven.', author: 'John Milton'},
                    {text: 'To be yourself in a world that is constantly trying to make you something else is the greatest accomplishment.', author: 'Ralph Waldo Emerson'},
                    {text: 'The only way out of the labyrinth of suffering is to forgive.', author: 'John Green'},
                    {text: 'We are all in the gutter, but some of us are looking at the stars.', author: 'Oscar Wilde'},
                    {text: 'It does not do to dwell on dreams and forget to live.', author: 'J.K. Rowling'},
                    {text: 'The world breaks everyone, and afterward, some are strong at the broken places.', author: 'Ernest Hemingway'},
                ];
                return fallbacks[Math.floor(Math.random() * fallbacks.length)];
            }

            // Create SVG symbol or text character
            function createSymbol(paths, size = 40, showLabel = false, letter = '') {
                const container = document.createElement('div');
                container.className = 'symbol-container';

                if (paths) {
                    // SVG symbol for letters
                    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svg.setAttribute('viewBox', '0 0 24 24');
                    svg.setAttribute('width', size);
                    svg.setAttribute('height', size);

                    paths.forEach((d) => {
                        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        path.setAttribute('d', d);
                        path.setAttribute('stroke', '#333');
                        path.setAttribute('fill', 'none');
                        path.setAttribute('stroke-width', '2');
                        path.setAttribute('stroke-linecap', 'round');
                        svg.appendChild(path);
                    });

                    container.appendChild(svg);
                } else {
                    // Text character for punctuation/numbers
                    const textChar = document.createElement('div');
                    textChar.style.fontSize = size + 'px';
                    textChar.style.lineHeight = size + 'px';
                    textChar.style.height = size + 'px';
                    textChar.style.fontWeight = 'bold';
                    textChar.style.display = 'flex';
                    textChar.style.alignItems = 'center';
                    textChar.style.justifyContent = 'center';
                    textChar.textContent = letter;
                    container.appendChild(textChar);
                }

                if (showLabel) {
                    const label = document.createElement('span');
                    label.className = 'symbol-label';
                    label.textContent = letter;
                    container.appendChild(label);
                }

                return container;
            }

            // Render encoded message
            let showLabels = true;

            function renderCipher(text) {
                const output = document.getElementById('output');
                output.innerHTML = '';

                if (!text.trim()) {
                    output.innerHTML = '<p style="color: #999; font-style: italic;">Your encoded message will appear here...</p>';
                    return;
                }

                const words = text.toLowerCase().split(/\s+/);
                words.forEach((word, idx) => {
                    const wordGroup = document.createElement('div');
                    wordGroup.className = 'word-group';

                    word.split('').forEach((char) => {
                        const paths = letters.get(char);
                        if (paths) {
                            wordGroup.appendChild(createSymbol(paths, 36, showLabels, char));
                        } else {
                            // Render punctuation with same structure as letters
                            wordGroup.appendChild(createSymbol(null, 36, showLabels, char));
                        }
                    });

                    if (wordGroup.children.length > 0) {
                        output.appendChild(wordGroup);
                    }
                });
            }

            // Practice mode functions
            let currentPracticeText = '';
            let currentPracticeAuthor = '';

            function renderPracticeCipher(text, container) {
                container.innerHTML = '';
                const words = text.toLowerCase().split(/\s+/);
                const cipherDiv = document.createElement('div');
                cipherDiv.style.display = 'flex';
                cipherDiv.style.flexWrap = 'wrap';
                cipherDiv.style.gap = '24px';
                cipherDiv.style.alignItems = 'center';

                words.forEach((word, idx) => {
                    const wordGroup = document.createElement('div');
                    wordGroup.style.display = 'flex';
                    wordGroup.style.gap = '4px';

                    word.split('').forEach((char) => {
                        const paths = letters.get(char);
                        if (paths) {
                            wordGroup.appendChild(createSymbol(paths, 36, false, char));
                        } else {
                            wordGroup.appendChild(createSymbol(null, 36, false, char));
                        }
                    });

                    if (wordGroup.children.length > 0) {
                        cipherDiv.appendChild(wordGroup);
                    }
                });
                container.appendChild(cipherDiv);
            }

            async function loadPracticeSentence() {
                const output = document.getElementById('practice-output');
                output.innerHTML = '<div class="loading">Loading practice sentence...</div>';
                document.getElementById('answer-section').classList.remove('visible');
                document.getElementById('practice-input').value = '';

                const quoteObj = await fetchRandomQuote();
                if (typeof quoteObj === 'string') {
                    currentPracticeText = quoteObj;
                    currentPracticeAuthor = '';
                } else {
                    currentPracticeText = quoteObj.text;
                    currentPracticeAuthor = quoteObj.author || '';
                }
                renderPracticeCipher(currentPracticeText, output);
            }

            function checkAnswer() {
                const userAnswer = document.getElementById('practice-input').value.trim();
                const correctAnswer = currentPracticeText.toLowerCase();
                const userAnswerLower = userAnswer.toLowerCase();

                // Normalize: remove extra spaces and punctuation for comparison
                const normalize = (str) =>
                    str
                        .replace(/[^a-z0-9\s]/gi, '')
                        .replace(/\s+/g, ' ')
                        .trim()
                        .toLowerCase();

                const answerSection = document.getElementById('answer-section');
                const answerText = document.getElementById('answer-text');

                answerSection.classList.add('visible');

                let authorHtml = currentPracticeAuthor ? `<br><span style="color:#555;font-style:italic;">— ${currentPracticeAuthor}</span>` : '';
                if (normalize(userAnswerLower) === normalize(correctAnswer)) {
                    answerText.innerHTML = `<strong style=\"color: #2d5;\">✓ Correct!</strong> \"${currentPracticeText}\"${authorHtml}`;
                } else {
                    answerText.innerHTML = `<strong style=\"color: #d52;\">✗ Not quite.</strong> The correct answer is: \"${currentPracticeText}\"${authorHtml}`;
                }
            }

            function revealAnswer() {
                const answerSection = document.getElementById('answer-section');
                const answerText = document.getElementById('answer-text');
                answerSection.classList.add('visible');
                let authorHtml = currentPracticeAuthor ? `<br><span style=\"color:#555;font-style:italic;\">— ${currentPracticeAuthor}</span>` : '';
                answerText.innerHTML = `\"${currentPracticeText}\"${authorHtml}`;
            }

            // Build reference modal
            function buildReference() {
                // Grid 1: A-I
                const grid1 = document.getElementById('grid-1');
                ['abc', 'def', 'ghi'].forEach((chars) => {
                    const row = document.createElement('div');
                    row.className = 'grid-row';
                    chars.split('').forEach((char) => {
                        row.appendChild(createSymbol(letters.get(char), 44, true, char));
                    });
                    grid1.appendChild(row);
                });

                // Grid 2: J-R
                const grid2 = document.getElementById('grid-2');
                ['jkl', 'mno', 'pqr'].forEach((chars) => {
                    const row = document.createElement('div');
                    row.className = 'grid-row';
                    chars.split('').forEach((char) => {
                        row.appendChild(createSymbol(letters.get(char), 44, true, char));
                    });
                    grid2.appendChild(row);
                });

                // Grid 3: Diamonds S-Z
                const grid3 = document.getElementById('grid-3');
                const diamondContainer = document.createElement('div');
                diamondContainer.className = 'diamond-container';

                // First diamond: S-V
                const diamond1 = document.createElement('div');
                diamond1.className = 'diamond';
                [['s'], ['t', 'u'], ['v']].forEach((chars) => {
                    const row = document.createElement('div');
                    row.className = 'grid-row';
                    chars.forEach((char) => {
                        row.appendChild(createSymbol(letters.get(char), 44, true, char));
                    });
                    diamond1.appendChild(row);
                });

                // Second diamond: W-Z
                const diamond2 = document.createElement('div');
                diamond2.className = 'diamond';
                [['w'], ['x', 'y'], ['z']].forEach((chars) => {
                    const row = document.createElement('div');
                    row.className = 'grid-row';
                    chars.forEach((char) => {
                        row.appendChild(createSymbol(letters.get(char), 44, true, char));
                    });
                    diamond2.appendChild(row);
                });

                diamondContainer.appendChild(diamond1);
                diamondContainer.appendChild(diamond2);
                grid3.appendChild(diamondContainer);

                // Full alphabet reference
                const alphabetRef = document.getElementById('alphabet-reference');
                'abcdefghijklmnopqrstuvwxyz'.split('').forEach((char) => {
                    const box = document.createElement('div');
                    box.className = 'letter-box';
                    box.appendChild(createSymbol(letters.get(char), 36, false));
                    const label = document.createElement('span');
                    label.className = 'letter-box-label';
                    label.textContent = char.toUpperCase();
                    box.appendChild(label);
                    alphabetRef.appendChild(box);
                });
            }

            // Modal control
            const modal = document.getElementById('reference-modal');
            const practiceModal = document.getElementById('practice-modal');
            const input = document.getElementById('cipher-input');
            let isModalOpen = false;
            let isPracticeModalOpen = false;

            function openModal() {
                modal.classList.add('active');
                isModalOpen = true;
            }

            function closeModal() {
                modal.classList.remove('active');
                isModalOpen = false;
            }

            function openPracticeModal() {
                practiceModal.classList.add('active');
                isPracticeModalOpen = true;
                loadPracticeSentence();
            }

            function closePracticeModal() {
                practiceModal.classList.remove('active');
                isPracticeModalOpen = false;
            }

            // Event listeners
            document.getElementById('show-reference').addEventListener('click', openModal);
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('practice-mode').addEventListener('click', openPracticeModal);
            document.getElementById('close-practice').addEventListener('click', closePracticeModal);
            document.getElementById('new-practice').addEventListener('click', loadPracticeSentence);
            document.getElementById('check-answer').addEventListener('click', checkAnswer);
            document.getElementById('reveal-answer').addEventListener('click', revealAnswer);

            document.getElementById('clear-btn').addEventListener('click', () => {
                input.value = '';
                renderCipher('');
            });

            document.getElementById('show-labels').addEventListener('change', (e) => {
                showLabels = e.target.checked;
                renderCipher(input.value);
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });

            practiceModal.addEventListener('click', (e) => {
                if (e.target === practiceModal) closePracticeModal();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'h' && document.activeElement !== input && !isModalOpen && !isPracticeModalOpen) {
                    openModal();
                } else if (e.key === 'Escape') {
                    if (isModalOpen) closeModal();
                    if (isPracticeModalOpen) closePracticeModal();
                }
            });

            input.addEventListener('input', (e) => renderCipher(e.target.value));

            // Initialize
            buildReference();
            renderCipher(input.value);
        </script>
    </body>
</html>
